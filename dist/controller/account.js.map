{"version":3,"sources":["../../src/controller/account.js"],"names":["TOKENTIME","SECRET","nodeMailer","require","config","db","api","post","req","res","findUserByEmail","body","email","err","userData","status","json","message","register","username","password","account","console","log","authenticate","session","send","next","scope","user","token","sign","expiresIn","id","_id","get","logout","waterfall","done","randomBytes","buf","toString","tokenExpiration","Date","now","passwordResetToken","save","smptTransport","createTransport","service","auth","XOAuth2","clienId","clientSecret","refreshToken","mailOptions","to","from","subject","text","sendMail","close","User","findOne","params","$gt","setPassword","undefined","error","success","pass"],"mappings":"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","file":"account.js","sourcesContent":["import mongoose from 'mongoose';\nimport { Router } from 'express';\nimport bodyParser from 'body-parser';\nimport passport from 'passport';\nimport config from '../config';\nimport Account from '../model/account';\nimport UserDataExt from './extensions/userData-ext';\nimport async from 'async';\nimport crypto from 'crypto';\nimport jwt from 'jsonwebtoken';\nimport expressJwt from 'express-jwt';\n\nimport { generateAccessToken, respond, authenticate } from '../middleware/authMiddleware';\n\nconst TOKENTIME = 60*60*24*90;\nconst SECRET = \"BadaGig SERVER SIDE\";\n\nvar  nodeMailer = require('nodemailer');\n\nexport default ({ config, db }) => {\n  let api = Router();\n\n  // '/v1/account/register'\n  api.post('/register', (req, res) => {\n    UserDataExt.findUserByEmail(req.body.email, (err, userData) => {\n      if (err) {\n        res.status(409).json({ message: `An error occured: ${err.message}`});\n        return;\n      } else if (userData) {\n        res.status(300).json({ message: `Email ${req.body.email} is already registered`});\n      }\n      // else {\n        Account.register(new Account({username: req.body.email}), req.body.password, function(err, account) {\n          if(err) {\n            res.status(500).json({ message: err });\n            return;\n          }\n          console.log(\"Registering new account\");\n          passport.authenticate('local', { session: false })(req, res, () => {\n              res.status(200).send('Successfully created new account');\n          });\n        });\n      // }\n    });\n  });\n\n  // '/v1/account/login'\n  api.post('/login', (req, res, next) => {\n\t\tUserDataExt.findUserByEmail(req.body.email, (err, userData) => {\n      if (err) {\n        res.status(409).json({ message: `An error occured: ${err.message}`});\n        return;\n      } else {\n\t\t\t\tnext();\n\t\t\t}\n    });\n\t}, passport.authenticate('local', { session: false, scope: [] }), (err, req, res, next) => {\n\t\tif (err) {\n\t\t\tres.status(401).json({ message: `Password is incorrect`});\n      return;\n\t\t}\n\t}, generateAccessToken, respond);\n\n  // '/v1/account/facebook/token'\n  api.post('/auth/facebook/token', passport.authenticate('facebook-token', {session: false}), (req, res, next) => {\n      if (req.user) {\n        console.log(`User req ${req.user}`);\n\n\n        req.token = req.token || {};\n        req.token = jwt.sign ({\n        }, SECRET, {\n          expiresIn: TOKENTIME // 90 days\n        });\n\n\n        res.status(200).json({\n          user: req.user.email,\n          token: req.token,\n          id: req.user._id\n        });\n        //res.status(200).json({message: `New user added from facebook successfully`});\n         //var token = authenticate.getToken({_id: req.user._id});\n      }\n  });\n\n  //'/v1/account/google/token'\n  api.post('/google/token', passport.authenticate('google', {scope: ['profile']}), (req, res) => {\n    if (req.user) {\n      console.log('Google token route');\n      generateAccessToken, respond;\n    }\n  })\n\n  // '/v1/account/logout'\n  api.get('/logout', authenticate, (req, res) => {\n    res.logout();\n    res.status(200).send('Successfully logged out');\n  });\n\n  api.get('/me', authenticate, (req, res) => {\n    res.status(200).json(req.user);\n  });\n\n  ///v1/account/forgot Generate token, token expiration and send email to user for instruction\n  api.post('/forgot', (req, res, next) => {\n    console.log('Trying to post');\n    async.waterfall([\n      (done) => {\n        crypto.randomBytes(4, (err, buf) => {\n          if (err) {\n            res.status(500).json({message: `An error occured: ${err.message}`});\n            return;\n          }\n            var token = buf.toString('hex');\n            done(err, token);\n        });\n      },\n        (token, done) => {\n          UserDataExt.findUserByEmail(req.body.email, (err, user) => {\n            console.log('Searching for user');\n            if (err) {\n              res.status(500).json({message: `An error occured: ${err.message}`});\n              return;\n            } else if (!user) {\n              res.status(404).json({message: `No user account found`});\n              return;\n            }\n            console.log('Assign token to user profile in mongodb');\n              user.tokenExpiration = Date.now() + 3600000 ;// one hour\n              user.passwordResetToken = token;\n            console.log('Saving token db');\n              user.save(err => {\n                if (err) {\n                  res.status(500).json({message: err});\n                  return;\n                }\n                done(err, user, token);\n              });\n          });\n        },\n\n      (err, user, token) => {\n        console.log('Tyring to login');\n        var smptTransport = nodeMailer.createTransport({\n          service: 'Gmail',\n          auth: {\n              XOAuth2: {\n                user: 'perfect.aduh@gmail.com',\n                clienId: '322793033087-q13jmff94tnv4gtqejqjio982kuoctfd.apps.googleusercontent.com',\n                clientSecret: 'YaSj9Bk2Og4nZlMlH8Twu_UB',\n                refreshToken: '1/iITHN8FnaWEZeMfPVrHxPojZ4AtCG22YLflgBxWm2W0'\n              }\n            }\n        });\n        var mailOptions = {\n          to: user.email,\n          from: 'noreply@badagig.ng',\n          subject: 'BadaGig Platform Password Reset Request',\n          text: 'Hello!' + '\\n' +\n            'You recently requested to reset your password for the BadaGig platform.' + '\\n' +\n            'Here is your reset code below.' + '\\n\\n' +\n                      token + '\\n\\n' +\n            'Copy the code above and use it to reset your password.' + '\\n\\n' +\n            'This code will only be valid for the next hour.' + '\\n' +\n            'If you did not request a password reset then please ignore this email.' + '\\n' +\n            'Thanks,' + '\\n' +\n            'Team BadaGig'\n        };\n          smptTransport.sendMail(mailOptions, (err) => {\n            console.log('Now sending mail');\n            if (err) {\n              console.log('Sendingmail failed');\n              res.status(500).json({message: `An error occured: ${err.message}`})\n              return;\n            }\n              //res.status(200).json({message: 'Password reset process has been iniated, please check your email'})\n              console.log('mail sent');\n              smptTransport.close();\n          });\n        }\n    ])\n  });\n\n  // /v1/account/reset/:token\n  api.get('/reset/:token', (req, res) => {\n    User.findOne({passwordResetToken: req.params.token, tokenExpiration: {$gt: Date.now()}}, (err, user) =>{\n      if (err) {\n        res.status(500).json({message: `An error occured: ${err.message}`});\n        return;\n      } else if (!user) {\n        res.status(404).json({message: 'Password reset token is invalid or has expired.' });\n        return;\n      }\n        res.status(200).json({message: 'Token found and valid'});\n    });\n  });\n\n  api.post('/reset/:token', (req, res) => {\n    async.waterfall([\n      (done) => {\n        User.findOne({passwordResetToken: req.params.token, tokenExpiration: {$gt: Date.now()}}, (err, user) =>{\n          if (err) {\n            res.status(500).json({message: `An error occured: ${err.message}`});\n            return;\n          } else if (!user) {\n            res.status(404).json({message: 'Password reset token is invalid or has expired.' });\n            return;\n          }\n          user.setPassword(req.body.password, (err) => {\n            user.passwordResetToken = undefined;\n            user.tokenExpiration = undefined;\n\n            user.save(err => {\n              if (err) {\n                res.status(500).json({error: 'Password reset failed, please try again'});\n                return;\n              }\n              res.status(200).json({success: 'Password has been reset successfully'});\n            });\n          });\n      });\n    },\n    (user, done) => {\n      var smptTransport = nodeMailer.createTransport({\n        service: 'Gmail',\n        auth: {\n          user: 'perfect.aduh@gmail.com',\n          pass: 'mmmmmmm'\n        }\n      });\n      var mailOptions = {\n        to: user.email,\n        from: `noreply@badagig.ng`,\n        subject: `BadaGig Platform Password Reset Request`,\n        text: `Hello!` + '\\n' +\n          'This is a confirmation that the password for your account user.email has been successfully updated' + '\\n' +\n          'Thanks,' + '\\n' +\n          'Team BadaGig'\n      };\n        smptTransport.sendMail(mailOptions, (err) => {\n          if (err) {\n            res.status(500).json({error: `An error occured: ${err.message}`})\n            return;\n          }\n            res.status(200).json({message: 'Password confirmation mail has been sent successfully'});\n          console.log('mail sent');\n        });\n      }\n    ])\n  });\n  return api;\n}\n"]}